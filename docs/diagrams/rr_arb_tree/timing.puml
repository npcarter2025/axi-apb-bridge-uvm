@startuml rr_arb_tree_timing
!theme plain
skinparam backgroundColor #FFFFFF
skinparam shadowing false

title Round-Robin Arbiter Tree Timing Diagram\nShowing Priority Rotation (NumIn=4)

concise "clk_i" as clk
robust "req_i[3:0]" as req_i
robust "gnt_i" as gnt_i
robust "req_o" as req_o
robust "idx_o" as idx_o
robust "data_o" as data_o
robust "gnt_o[3:0]" as gnt_o
robust "rr_q" as rr_q
robust "Priority" as priority

@0
clk is 0
req_i is "0000"
gnt_i is 0
req_o is 0
idx_o is "-"
data_o is "-"
gnt_o is "0000"
rr_q is 0
priority is "Input 0"

@25
clk is 1
@30
req_i is "0111"
@37
req_o is 1
idx_o is 0
data_o is "A"
gnt_i is 1
@45
gnt_o is "0001"

@50
clk is 0

note bottom of priority : Priority 0 wins

@75
clk is 1
@80
rr_q is 1
priority is "Input 1"
@87
idx_o is 1
data_o is "B"
@95
gnt_o is "0010"

@100
clk is 0

note bottom of priority : Priority 1 wins

@125
clk is 1
@130
req_i is "0101"
rr_q is 2
priority is "Input 2"
@137
idx_o is 2
data_o is "C"
@145
gnt_o is "0100"

@150
clk is 0

note bottom of priority : Priority 2 wins

@175
clk is 1
@180
rr_q is 0
priority is "Input 0"
@187
idx_o is 0
data_o is "A"
@195
gnt_o is "0001"

@200
clk is 0

note bottom of priority : Wrapped to 0

@225

highlight 25 to 50 #C8E6C9 : Priority 0
highlight 75 to 100 #E1F5FE : Priority 1
highlight 125 to 150 #FFE0B2 : Priority 2
highlight 175 to 200 #E8F5E9 : Priority 0

legend bottom
    Priority rotates after each grant
    Round-robin ensures fair access
    idx_o changes combinationally
    rr_q updates at clock edge
end legend

@enduml
